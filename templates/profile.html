{% set page = "profile" %}
{% include "layout.html" %}

{% block content %}
{% if status == "need_login" %}
<div class="min-h-screen bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-100">
  <main class="max-w-4xl mx-auto px-6 py-8 pb-32">
    <div class="bg-white/90 p-6 rounded-2xl shadow-xl text-center">
      <h2 class="text-2xl font-bold text-slate-800 mb-4">ë¡œê·¸ì¸ì´ í•„ìš”í•œ ì„œë¹„ìŠ¤ì…ë‹ˆë‹¤.</h2>
      <a href="/login">
        <button class="bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700">
          ë¡œê·¸ì¸ í•˜ëŸ¬ ê°€ê¸°
        </button>
      </a>
    </div>
    {% else %}
    <div class="profile-container">
      <aside class="sidebar">
        <div class="user-info-box">
          <h2><b>ìœ ì € ì •ë³´</b></h2>
          <p><strong>ì´ë¦„:</strong> {{ data.userInfo.name }}</p>
          <p><strong>ë‹‰ë„¤ì„:</strong> {{ data.userInfo.nickname }}</p>
          <p><strong>ìƒë…„ì›”ì¼:</strong> {{ data.userInfo.birth }}</p>
        </div>
        <nav class="menu-tabs">
          <button id="show-songs-btn" class="active" onclick="showPanel('songs')">â¤ï¸ ì¢‹ì•„ìš” ëˆ„ë¥¸ ê³¡</button>
          <button id="show-posts-btn" onclick="showPanel('posts')">ğŸ“„ ì‘ì„±í•œ ê¸€</button>
          <button id="show-edit-btn" onclick="showPanel('edit')">âš™ï¸ í”„ë¡œí•„ ìˆ˜ì •</button>
        </nav>
      </aside>

      <main class="content-area">
        <div id="edit-panel" class="content-panel">
          <h2 class="text-xl font-bold mb-6 text-slate-800">í”„ë¡œí•„ ìˆ˜ì •</h2>
          <form id="edit-profile-form" class="space-y-6 max-w-md">

            <div class="flex gap-4 items-end">
              <div class="flex-1">
                <label for="edit-name" class="block text-sm font-medium text-slate-700">ì´ë¦„</label>
                <input type="text" id="edit-name" name="name" value="{{ data.userInfo.name }}"
                  class="mt-1 w-full px-3 py-2 border border-gray-300 rounded-lg shadow-sm focus:ring-indigo-500 focus:border-indigo-500">
              </div>
              <button type="button"
                class="px-4 h-[42px] bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition"
                onclick="updateField('name')">
                ë³€ê²½
              </button>
            </div>

            <div class="flex gap-4 items-end">
              <div class="flex-1">
                <label for="edit-nickname" class="block text-sm font-medium text-slate-700">ë‹‰ë„¤ì„</label>
                <input type="text" id="edit-nickname" name="nickname" value="{{ data.userInfo.nickname }}"
                  class="mt-1 w-full px-3 py-2 border border-gray-300 rounded-lg shadow-sm focus:ring-indigo-500 focus:border-indigo-500">
              </div>
              <button type="button"
                class="px-4 h-[42px] bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition"
                onclick="updateField('nickname')">
                ë³€ê²½
              </button>
            </div>

            <div class="flex gap-4 items-end">
              <div class="flex-1">
                <label for="edit-birth" class="block text-sm font-medium text-slate-700">ìƒë…„ì›”ì¼</label>
                <input type="date" id="edit-birth" name="birth" value="{{ data.userInfo.birth }}"
                  class="mt-1 w-full px-3 py-2 border border-gray-300 rounded-lg shadow-sm focus:ring-indigo-500 focus:border-indigo-500">
              </div>
              <button type="button"
                class="px-4 h-[42px] bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition"
                onclick="updateField('birth')">
                ë³€ê²½
              </button>
            </div>

            <div class="pt-4 border-t border-gray-200">
              <a href="/changepw" class="text-indigo-600 font-medium hover:underline">
                ë¹„ë°€ë²ˆí˜¸ ë³€ê²½
              </a>
            </div>

          </form>
        </div>
        <div id="songs-panel" class="content-panel active">
          <h2 class="text-xl font-bold mb-6 text-slate-800">ì¢‹ì•„ìš” ëˆ„ë¥¸ ê³¡</h2>
          {% for song in data.likedSongs %}
          <div class="list-item" data-item-id="{{ song.track_id }}" style="cursor:pointer;">
            <img src="{{ song.album_cover }}" alt="ì•¨ë²” ì»¤ë²„">
            <div>
              <strong>{{ song.title }}</strong>
              <p style="margin: 4px 0; color: #666;">{{ song.artist_name }}</p>
            </div>
            <button class="unlike-btn" data-track-id="{{ song.track_id }}">X</button>
          </div>
          {% else %}
          <p>ì¢‹ì•„ìš”ë¥¼ ëˆ„ë¥¸ ë…¸ë˜ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
          {% endfor %}
        </div>

        <div id="posts-panel" class="content-panel">
          <h2 class="text-xl font-bold mb-6 text-slate-800">ì‘ì„±í•œ ê¸€</h2>
          {% for post in data.authoredPosts %}
          <div class="list-item">
            <div>
              <a href="{{ url_for('community.post_detail', post_id=post._id) }}">{{ post.title }}</a>
            </div>
            <span class="post-date">{{ post.created_at | string | truncate(10, True, '') }}</span>
          </div>
          {% else %}
          <p>ì‘ì„±í•œ ê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</p>
          {% endfor %}
        </div>
      </main>
    </div>
    {% endif %}
    {% endblock %}